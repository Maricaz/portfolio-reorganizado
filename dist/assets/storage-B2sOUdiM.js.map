{"version":3,"file":"storage-B2sOUdiM.js","names":[],"sources":["../../../../cache/modules/portfolio-reorganizado-7831f/node_modules/.pnpm/lucide-react@0.562.0_react@19.2.3/node_modules/lucide-react/dist/esm/icons/search.js","../../src/lib/image-optimizer.ts","../../src/services/storage.ts"],"sourcesContent":["/**\n * @license lucide-react v0.562.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m21 21-4.34-4.34\", key: \"14j7rj\" }],\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }]\n];\nconst Search = createLucideIcon(\"search\", __iconNode);\n\nexport { __iconNode, Search as default };\n//# sourceMappingURL=search.js.map\n","export async function optimizeImage(\n  file: File,\n  maxWidth = 1200,\n  quality = 0.8,\n): Promise<File> {\n  // Only optimize images, skip SVGs\n  if (!file.type.startsWith('image/') || file.type.includes('svg')) {\n    return file\n  }\n\n  return new Promise((resolve, reject) => {\n    const img = new Image()\n    const reader = new FileReader()\n\n    reader.onload = (e) => {\n      img.src = e.target?.result as string\n    }\n\n    reader.onerror = (e) => reject(e)\n\n    img.onload = () => {\n      let width = img.width\n      let height = img.height\n\n      // Resize logic\n      if (width > maxWidth) {\n        height = Math.round((height * maxWidth) / width)\n        width = maxWidth\n      }\n\n      const canvas = document.createElement('canvas')\n      canvas.width = width\n      canvas.height = height\n\n      const ctx = canvas.getContext('2d')\n      if (!ctx) {\n        // Fallback if context is not available\n        resolve(file)\n        return\n      }\n\n      // Draw image\n      ctx.drawImage(img, 0, 0, width, height)\n\n      // Compress\n      canvas.toBlob(\n        (blob) => {\n          if (!blob) {\n            resolve(file)\n            return\n          }\n          // If optimization increased size (rare but possible), keep original\n          if (blob.size > file.size) {\n            resolve(file)\n            return\n          }\n          const optimizedFile = new File([blob], file.name, {\n            type: file.type,\n            lastModified: Date.now(),\n          })\n          resolve(optimizedFile)\n        },\n        file.type,\n        quality,\n      )\n    }\n\n    reader.readAsDataURL(file)\n  })\n}\n","import { supabase } from '@/lib/supabase/client'\nimport { optimizeImage } from '@/lib/image-optimizer'\n\nexport const uploadFile = async (\n  file: File,\n  bucket: string = 'portfolio-media',\n  folder: string = 'general',\n) => {\n  let fileToUpload = file\n\n  try {\n    // Attempt to optimize image before upload\n    // optimizeImage will skip non-image files\n    fileToUpload = await optimizeImage(file)\n  } catch (error) {\n    console.warn(\n      'Image optimization failed, proceeding with original file:',\n      error,\n    )\n  }\n\n  const fileExt = fileToUpload.name.split('.').pop()\n  const fileName = `${Math.random().toString(36).substring(2, 15)}_${Date.now()}.${fileExt}`\n  const filePath = `${folder}/${fileName}`\n\n  const { error: uploadError } = await supabase.storage\n    .from(bucket)\n    .upload(filePath, fileToUpload, {\n      upsert: true,\n    })\n\n  if (uploadError) {\n    throw uploadError\n  }\n\n  const { data } = supabase.storage.from(bucket).getPublicUrl(filePath)\n\n  return data.publicUrl\n}\n"],"x_google_ignoreList":[0],"mappings":";AAaA,IAAM,SAAS,iBAAiB,UAJb,CACjB,CAAC,QAAQ;CAAE,GAAG;CAAoB,KAAK;CAAU,CAAC,EAClD,CAAC,UAAU;CAAE,IAAI;CAAM,IAAI;CAAM,GAAG;CAAK,KAAK;CAAU,CAAC,CAC1D,CACoD;ACbrD,eAAsB,cACpB,MACA,WAAW,MACX,UAAU,IACK;AAEf,KAAI,CAAC,KAAK,KAAK,WAAW,SAAS,IAAI,KAAK,KAAK,SAAS,MAAM,CAC9D,QAAO;AAGT,QAAO,IAAI,SAAS,SAAS,WAAW;EACtC,MAAM,MAAM,IAAI,OAAO;EACvB,MAAM,SAAS,IAAI,YAAY;AAE/B,SAAO,UAAU,MAAM;AACrB,OAAI,MAAM,EAAE,QAAQ;;AAGtB,SAAO,WAAW,MAAM,OAAO,EAAE;AAEjC,MAAI,eAAe;GACjB,IAAI,QAAQ,IAAI;GAChB,IAAI,SAAS,IAAI;AAGjB,OAAI,QAAQ,UAAU;AACpB,aAAS,KAAK,MAAO,SAAS,WAAY,MAAM;AAChD,YAAQ;;GAGV,MAAM,SAAS,SAAS,cAAc,SAAS;AAC/C,UAAO,QAAQ;AACf,UAAO,SAAS;GAEhB,MAAM,MAAM,OAAO,WAAW,KAAK;AACnC,OAAI,CAAC,KAAK;AAER,YAAQ,KAAK;AACb;;AAIF,OAAI,UAAU,KAAK,GAAG,GAAG,OAAO,OAAO;AAGvC,UAAO,QACJ,SAAS;AACR,QAAI,CAAC,MAAM;AACT,aAAQ,KAAK;AACb;;AAGF,QAAI,KAAK,OAAO,KAAK,MAAM;AACzB,aAAQ,KAAK;AACb;;AAMF,YAJsB,IAAI,KAAK,CAAC,KAAK,EAAE,KAAK,MAAM;KAChD,MAAM,KAAK;KACX,cAAc,KAAK,KAAK;KACzB,CAAC,CACoB;MAExB,KAAK,MACL,QACD;;AAGH,SAAO,cAAc,KAAK;GAC1B;;ACjEJ,MAAa,aAAa,OACxB,MACA,SAAiB,mBACjB,SAAiB,cACd;CACH,IAAI,eAAe;AAEnB,KAAI;AAGF,iBAAe,MAAM,cAAc,KAAK;UACjC,OAAO;AACd,UAAQ,KACN,6DACA,MACD;;CAGH,MAAM,UAAU,aAAa,KAAK,MAAM,IAAI,CAAC,KAAK;CAElD,MAAM,WAAW,GAAG,OAAO,GADV,GAAG,KAAK,QAAQ,CAAC,SAAS,GAAG,CAAC,UAAU,GAAG,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,GAAG;CAGjF,MAAM,EAAE,OAAO,gBAAgB,MAAM,SAAS,QAC3C,KAAK,OAAO,CACZ,OAAO,UAAU,cAAc,EAC9B,QAAQ,MACT,CAAC;AAEJ,KAAI,YACF,OAAM;CAGR,MAAM,EAAE,SAAS,SAAS,QAAQ,KAAK,OAAO,CAAC,aAAa,SAAS;AAErE,QAAO,KAAK"}