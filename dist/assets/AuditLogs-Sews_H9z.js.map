{"version":3,"file":"AuditLogs-Sews_H9z.js","names":[],"sources":["../../../../cache/modules/portfolio-reorganizado-7831f/node_modules/.pnpm/lucide-react@0.562.0_react@19.2.3/node_modules/lucide-react/dist/esm/icons/refresh-cw.js","../../src/services/audit.ts","../../src/pages/admin/AuditLogs.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.562.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\", key: \"v9h5vc\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }],\n  [\"path\", { d: \"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\", key: \"3uifl3\" }],\n  [\"path\", { d: \"M8 16H3v5\", key: \"1cv678\" }]\n];\nconst RefreshCw = createLucideIcon(\"refresh-cw\", __iconNode);\n\nexport { __iconNode, RefreshCw as default };\n//# sourceMappingURL=refresh-cw.js.map\n","import { supabase } from '@/lib/supabase/client'\n\nexport interface AuditLog {\n  id: string\n  user_id: string\n  action: 'INSERT' | 'UPDATE' | 'DELETE'\n  table_name: string\n  record_id: string\n  old_data: any\n  new_data: any\n  created_at: string\n}\n\nexport const getAuditLogs = async () => {\n  const { data, error } = await supabase\n    .from('audit_logs')\n    .select('*')\n    .order('created_at', { ascending: false })\n    .limit(100)\n    .returns<AuditLog[]>()\n\n  if (error) {\n    console.error('Error fetching audit logs:', error)\n    return []\n  }\n\n  return data\n}\n\nexport const getAuditLogsPaginated = async (\n  page: number = 1,\n  limit: number = 10,\n) => {\n  const from = (page - 1) * limit\n  const to = from + limit - 1\n\n  const { data, error, count } = await supabase\n    .from('audit_logs')\n    .select('*', { count: 'exact' })\n    .order('created_at', { ascending: false })\n    .range(from, to)\n    .returns<AuditLog[]>()\n\n  if (error) throw error\n\n  return {\n    data: data || [],\n    count: count || 0,\n    totalPages: count ? Math.ceil(count / limit) : 0,\n  }\n}\n","import { useEffect, useState } from 'react'\nimport { getAuditLogsPaginated, AuditLog } from '@/services/audit'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Eye, Loader2, RefreshCw } from 'lucide-react'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport { PaginationControl } from '@/components/PaginationControl'\nimport { ExportButton } from '@/components/admin/ExportButton'\nimport { useAuth } from '@/hooks/use-auth'\n\nexport default function AuditLogs() {\n  const [logs, setLogs] = useState<AuditLog[]>([])\n  const [loading, setLoading] = useState(true)\n  const [selectedLog, setSelectedLog] = useState<AuditLog | null>(null)\n  const [currentPage, setCurrentPage] = useState(1)\n  const [totalPages, setTotalPages] = useState(1)\n  const { hasPermission } = useAuth()\n  const pageSize = 10\n\n  useEffect(() => {\n    if (hasPermission('audit')) {\n      fetchLogs()\n    } else {\n      setLoading(false)\n    }\n  }, [currentPage])\n\n  const fetchLogs = async () => {\n    setLoading(true)\n    try {\n      const {\n        data,\n        count,\n        totalPages: total,\n      } = await getAuditLogsPaginated(currentPage, pageSize)\n      setLogs(data)\n      setTotalPages(total)\n    } catch (err) {\n      console.error(err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getActionColor = (action: string) => {\n    switch (action) {\n      case 'INSERT':\n        return 'bg-green-500 hover:bg-green-600'\n      case 'UPDATE':\n        return 'bg-blue-500 hover:bg-blue-600'\n      case 'DELETE':\n        return 'bg-red-500 hover:bg-red-600'\n      default:\n        return 'bg-gray-500'\n    }\n  }\n\n  if (!hasPermission('audit')) {\n    return (\n      <div className=\"flex h-[50vh] flex-col items-center justify-center gap-4 text-center\">\n        <h2 className=\"text-xl font-bold\">Access Restricted</h2>\n        <p className=\"text-muted-foreground\">\n          You do not have permission to view audit logs.\n        </p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6 animate-fade-in\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-1\">\n          <h1 className=\"text-3xl font-bold\">Audit Logs</h1>\n          <p className=\"text-muted-foreground\">\n            Track system changes and activity for accountability.\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <ExportButton data={logs} filename=\"audit_logs\" />\n          <Button variant=\"outline\" onClick={fetchLogs} disabled={loading}>\n            {loading ? (\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n            ) : (\n              <RefreshCw className=\"mr-2 h-4 w-4\" />\n            )}\n            Refresh\n          </Button>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Change History</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Timestamp</TableHead>\n                <TableHead>Action</TableHead>\n                <TableHead>Table</TableHead>\n                <TableHead>User ID</TableHead>\n                <TableHead className=\"text-right\">Details</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {loading ? (\n                <TableRow>\n                  <TableCell colSpan={5} className=\"h-24 text-center\">\n                    <Loader2 className=\"h-6 w-6 animate-spin mx-auto text-muted-foreground\" />\n                  </TableCell>\n                </TableRow>\n              ) : (\n                logs.map((log) => (\n                  <TableRow key={log.id}>\n                    <TableCell className=\"font-mono text-xs text-muted-foreground\">\n                      {new Date(log.created_at).toLocaleString()}\n                    </TableCell>\n                    <TableCell>\n                      <Badge\n                        className={`${getActionColor(log.action)} text-white`}\n                      >\n                        {log.action}\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"font-medium\">\n                      {log.table_name}\n                    </TableCell>\n                    <TableCell className=\"font-mono text-xs text-muted-foreground\">\n                      {log.user_id ? log.user_id : 'System/Unknown'}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setSelectedLog(log)}\n                      >\n                        <Eye className=\"h-4 w-4\" />\n                        <span className=\"sr-only\">View Details</span>\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n              {!loading && logs.length === 0 && (\n                <TableRow>\n                  <TableCell colSpan={5} className=\"text-center h-24\">\n                    No activity recorded yet.\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n\n          <PaginationControl\n            currentPage={currentPage}\n            totalPages={totalPages}\n            onPageChange={setCurrentPage}\n          />\n        </CardContent>\n      </Card>\n\n      <Dialog\n        open={!!selectedLog}\n        onOpenChange={(open) => !open && setSelectedLog(null)}\n      >\n        <DialogContent className=\"max-w-4xl max-h-[80vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>Audit Log Details</DialogTitle>\n            <DialogDescription>\n              {selectedLog?.action} on {selectedLog?.table_name} by{' '}\n              {selectedLog?.user_id}\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 flex-1 overflow-hidden min-h-[300px]\">\n            <div className=\"flex flex-col gap-2 h-full\">\n              <h4 className=\"font-semibold text-sm flex items-center gap-2\">\n                <span className=\"w-2 h-2 rounded-full bg-red-500\" />\n                Old Data (Before)\n              </h4>\n              <ScrollArea className=\"flex-1 rounded-md border p-4 bg-muted/30\">\n                {selectedLog?.old_data ? (\n                  <pre className=\"text-xs font-mono whitespace-pre-wrap break-all text-muted-foreground\">\n                    {JSON.stringify(selectedLog.old_data, null, 2)}\n                  </pre>\n                ) : (\n                  <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm italic\">\n                    No previous data (Insert)\n                  </div>\n                )}\n              </ScrollArea>\n            </div>\n\n            <div className=\"flex flex-col gap-2 h-full\">\n              <h4 className=\"font-semibold text-sm flex items-center gap-2\">\n                <span className=\"w-2 h-2 rounded-full bg-green-500\" />\n                New Data (After)\n              </h4>\n              <ScrollArea className=\"flex-1 rounded-md border p-4 bg-muted/30\">\n                {selectedLog?.new_data ? (\n                  <pre className=\"text-xs font-mono whitespace-pre-wrap break-all text-muted-foreground\">\n                    {JSON.stringify(selectedLog.new_data, null, 2)}\n                  </pre>\n                ) : (\n                  <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm italic\">\n                    Deleted\n                  </div>\n                )}\n              </ScrollArea>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n"],"x_google_ignoreList":[0],"mappings":"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"}