{"version":3,"file":"MusicManager-CX_Pgzlf.js","names":[],"sources":["../../src/pages/admin/MusicManager.tsx"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport * as z from 'zod'\nimport {\n  getMusicTracks,\n  createTrack,\n  updateTrack,\n  deleteTrack,\n} from '@/services/music'\nimport { uploadFile } from '@/services/storage'\nimport { MusicTrack } from '@/types'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog'\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form'\nimport { useToast } from '@/hooks/use-toast'\nimport { Plus, Pencil, Trash, Image as ImageIcon } from 'lucide-react'\nimport { ExportButton } from '@/components/admin/ExportButton'\n\nconst trackSchema = z.object({\n  title: z.string().min(1, 'Title is required'),\n  artist: z.string().min(1, 'Artist is required'),\n  src_url: z.string().url('Must be a valid URL').optional().or(z.literal('')),\n  image_url: z.string().optional(),\n})\n\ntype TrackFormValues = z.infer<typeof trackSchema>\n\nexport default function MusicManager() {\n  const [tracks, setTracks] = useState<MusicTrack[]>([])\n  const [isOpen, setIsOpen] = useState(false)\n  const [editingId, setEditingId] = useState<string | null>(null)\n  const [uploading, setUploading] = useState(false)\n  const { toast } = useToast()\n\n  const form = useForm<TrackFormValues>({\n    resolver: zodResolver(trackSchema),\n    defaultValues: {\n      title: '',\n      artist: '',\n      src_url: '',\n      image_url: '',\n    },\n  })\n\n  const loadTracks = async () => {\n    try {\n      const data = await getMusicTracks()\n      setTracks(data || [])\n    } catch (error) {\n      toast({\n        title: 'Error',\n        description: 'Failed to load tracks',\n        variant: 'destructive',\n      })\n    }\n  }\n\n  useEffect(() => {\n    loadTracks()\n  }, [])\n\n  const handleEdit = (track: MusicTrack) => {\n    setEditingId(track.id)\n    form.reset({\n      title: track.title,\n      artist: track.artist,\n      src_url: track.src_url || '',\n      image_url: (track as any).image_url || '',\n    })\n    setIsOpen(true)\n  }\n\n  const handleAddNew = () => {\n    setEditingId(null)\n    form.reset({\n      title: '',\n      artist: '',\n      src_url: '',\n      image_url: '',\n    })\n    setIsOpen(true)\n  }\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    try {\n      setUploading(true)\n      const url = await uploadFile(file, 'portfolio-media', 'music')\n      form.setValue('image_url', url)\n      toast({ title: 'Success', description: 'Album art uploaded' })\n    } catch (error) {\n      toast({\n        title: 'Upload Error',\n        description: 'Failed to upload image',\n        variant: 'destructive',\n      })\n    } finally {\n      setUploading(false)\n    }\n  }\n\n  const onSubmit = async (values: TrackFormValues) => {\n    try {\n      if (editingId) {\n        await updateTrack(editingId, values)\n        toast({ title: 'Success', description: 'Track updated' })\n      } else {\n        await createTrack(values as MusicTrack)\n        toast({ title: 'Success', description: 'Track created' })\n      }\n      setIsOpen(false)\n      loadTracks()\n    } catch (error) {\n      toast({\n        title: 'Error',\n        description: 'Operation failed',\n        variant: 'destructive',\n      })\n    }\n  }\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Are you sure?')) return\n    try {\n      await deleteTrack(id)\n      loadTracks()\n      toast({ title: 'Success', description: 'Track deleted' })\n    } catch (error) {\n      toast({\n        title: 'Error',\n        description: 'Failed to delete',\n        variant: 'destructive',\n      })\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div className=\"space-y-1\">\n          <h1 className=\"text-3xl font-bold\">Music Manager</h1>\n          <p className=\"text-muted-foreground\">\n            Manage your tracks and albums.\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <ExportButton data={tracks} filename=\"music_export\" />\n          <Dialog open={isOpen} onOpenChange={setIsOpen}>\n            <DialogTrigger asChild>\n              <Button onClick={handleAddNew}>\n                <Plus className=\"mr-2 h-4 w-4\" /> Add Track\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>\n                  {editingId ? 'Edit Track' : 'Add Track'}\n                </DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form\n                  onSubmit={form.handleSubmit(onSubmit)}\n                  className=\"space-y-4\"\n                >\n                  <FormField\n                    control={form.control}\n                    name=\"title\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Title</FormLabel>\n                        <FormControl>\n                          <Input {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"artist\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Artist</FormLabel>\n                        <FormControl>\n                          <Input {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"src_url\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Audio URL (MP3)</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"https://...\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"space-y-2\">\n                    <FormLabel>Album Art</FormLabel>\n                    <div className=\"flex gap-4 items-center\">\n                      <Input\n                        type=\"file\"\n                        accept=\"image/*\"\n                        onChange={handleImageUpload}\n                        disabled={uploading}\n                      />\n                      {form.watch('image_url') && (\n                        <div className=\"relative h-16 w-16 border rounded overflow-hidden shrink-0\">\n                          <img\n                            src={form.watch('image_url')}\n                            alt=\"Preview\"\n                            className=\"h-full w-full object-cover\"\n                          />\n                        </div>\n                      )}\n                    </div>\n                    <FormField\n                      control={form.control}\n                      name=\"image_url\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input placeholder=\"Or image URL...\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <Button type=\"submit\" className=\"w-full\" disabled={uploading}>\n                    {uploading ? 'Uploading...' : 'Save Track'}\n                  </Button>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      <div className=\"border rounded-md\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Art</TableHead>\n              <TableHead>Title</TableHead>\n              <TableHead>Artist</TableHead>\n              <TableHead>Actions</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {tracks.map((track) => (\n              <TableRow key={track.id}>\n                <TableCell>\n                  {(track as any).image_url ? (\n                    <img\n                      src={(track as any).image_url}\n                      alt=\"\"\n                      className=\"h-10 w-10 object-cover rounded\"\n                    />\n                  ) : (\n                    <div className=\"h-10 w-10 bg-muted rounded flex items-center justify-center\">\n                      <ImageIcon className=\"h-4 w-4 text-muted-foreground\" />\n                    </div>\n                  )}\n                </TableCell>\n                <TableCell className=\"font-medium\">{track.title}</TableCell>\n                <TableCell>{track.artist}</TableCell>\n                <TableCell className=\"flex gap-2\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => handleEdit(track)}\n                  >\n                    <Pencil className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"text-destructive\"\n                    onClick={() => handleDelete(track.id)}\n                  >\n                    <Trash className=\"h-4 w-4\" />\n                  </Button>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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"}