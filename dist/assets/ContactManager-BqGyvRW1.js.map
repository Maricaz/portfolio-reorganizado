{"version":3,"file":"ContactManager-BqGyvRW1.js","names":[],"sources":["../../src/services/contact.ts","../../src/pages/admin/ContactManager.tsx"],"sourcesContent":["import { supabase } from '@/lib/supabase/client'\nimport { ContactFormData } from '@/types'\nimport { sendPushNotification } from '@/services/push'\n\nexport const submitContactForm = async (data: ContactFormData) => {\n  // 1. Send to Supabase Database\n  const { error: dbError } = await supabase.from('contact_submissions').insert({\n    name: data.name,\n    email: data.email,\n    message: data.message,\n    origin: data.origin || 'web',\n  })\n\n  if (dbError) throw dbError\n\n  // 2. Send Push Notification (Client-side trigger for immediate feedback)\n  // Note: Ideally this is done via Database Webhooks, but for robustness in this demo environment:\n  try {\n    await sendPushNotification(\n      'New Contact',\n      `From: ${data.name}`,\n      '/admin/contacts',\n    )\n  } catch (err) {\n    console.warn('Failed to trigger push notification:', err)\n  }\n\n  // 3. Send to Formspree (Legacy/Backup)\n  const FORMSPREE_ENDPOINT = import.meta.env.VITE_FORMSPREE_ENDPOINT\n  if (FORMSPREE_ENDPOINT && !FORMSPREE_ENDPOINT.includes('PLACEHOLDER')) {\n    try {\n      await fetch(FORMSPREE_ENDPOINT, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      })\n    } catch (error) {\n      console.error('Formspree submission failed:', error)\n    }\n  }\n\n  return true\n}\n\nexport const getContactSubmissions = async () => {\n  const { data, error } = await supabase\n    .from('contact_submissions')\n    .select('*')\n    .order('created_at', { ascending: false })\n\n  if (error) throw error\n  return data\n}\n\nexport const deleteContactSubmission = async (id: string) => {\n  const { error } = await supabase\n    .from('contact_submissions')\n    .delete()\n    .eq('id', id)\n\n  if (error) throw error\n  return true\n}\n","import { useState, useEffect } from 'react'\nimport {\n  getContactSubmissions,\n  deleteContactSubmission,\n} from '@/services/contact'\nimport { ContactSubmission } from '@/types'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport { Button } from '@/components/ui/button'\nimport { Trash, Loader2, Mail, ExternalLink } from 'lucide-react'\nimport { useToast } from '@/hooks/use-toast'\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog'\nimport { ExportButton } from '@/components/admin/ExportButton'\n\nexport default function ContactManager() {\n  const [submissions, setSubmissions] = useState<ContactSubmission[]>([])\n  const [loading, setLoading] = useState(true)\n  const { toast } = useToast()\n\n  const loadSubmissions = async () => {\n    try {\n      setLoading(true)\n      const data = await getContactSubmissions()\n      setSubmissions(data)\n    } catch (error) {\n      toast({\n        title: 'Error',\n        description: 'Failed to load submissions',\n        variant: 'destructive',\n      })\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    loadSubmissions()\n  }, [])\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Are you sure you want to delete this message?')) return\n\n    try {\n      await deleteContactSubmission(id)\n      setSubmissions((prev) => prev.filter((s) => s.id !== id))\n      toast({ title: 'Success', description: 'Message deleted' })\n    } catch (error) {\n      toast({\n        title: 'Error',\n        description: 'Failed to delete message',\n        variant: 'destructive',\n      })\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">\n            Contact Messages\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Manage incoming messages from the contact form.\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <ExportButton data={submissions} filename=\"contact_submissions\" />\n          <Button onClick={loadSubmissions} variant=\"outline\" size=\"sm\">\n            Refresh\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"border rounded-md\">\n        {loading ? (\n          <div className=\"flex flex-col items-center justify-center p-12 space-y-2\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            <p className=\"text-sm text-muted-foreground\">Loading messages...</p>\n          </div>\n        ) : submissions.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center p-12 space-y-2 text-center\">\n            <div className=\"rounded-full bg-muted p-3\">\n              <Mail className=\"h-6 w-6 text-muted-foreground\" />\n            </div>\n            <h3 className=\"font-semibold text-lg\">No messages yet</h3>\n            <p className=\"text-sm text-muted-foreground max-w-sm\">\n              Messages sent through the contact form will appear here.\n            </p>\n          </div>\n        ) : (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Date</TableHead>\n                <TableHead>Name</TableHead>\n                <TableHead>Email</TableHead>\n                <TableHead>Message Preview</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {submissions.map((submission) => (\n                <TableRow key={submission.id}>\n                  <TableCell className=\"whitespace-nowrap\">\n                    {new Date(submission.created_at).toLocaleDateString()}\n                  </TableCell>\n                  <TableCell className=\"font-medium\">\n                    {submission.name}\n                  </TableCell>\n                  <TableCell>\n                    <a\n                      href={`mailto:${submission.email}`}\n                      className=\"hover:underline flex items-center gap-1\"\n                    >\n                      {submission.email}\n                      <ExternalLink className=\"h-3 w-3 opacity-50\" />\n                    </a>\n                  </TableCell>\n                  <TableCell className=\"max-w-md truncate\">\n                    {submission.message}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <div className=\"flex justify-end gap-2\">\n                      <Dialog>\n                        <DialogTrigger asChild>\n                          <Button variant=\"ghost\" size=\"sm\">\n                            View\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                          <DialogHeader>\n                            <DialogTitle>Message Details</DialogTitle>\n                          </DialogHeader>\n                          <div className=\"space-y-4\">\n                            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                              <div>\n                                <span className=\"font-semibold block text-muted-foreground\">\n                                  From\n                                </span>\n                                {submission.name}\n                              </div>\n                              <div>\n                                <span className=\"font-semibold block text-muted-foreground\">\n                                  Date\n                                </span>\n                                {new Date(\n                                  submission.created_at,\n                                ).toLocaleString()}\n                              </div>\n                              <div className=\"col-span-2\">\n                                <span className=\"font-semibold block text-muted-foreground\">\n                                  Email\n                                </span>\n                                <a\n                                  href={`mailto:${submission.email}`}\n                                  className=\"text-primary hover:underline\"\n                                >\n                                  {submission.email}\n                                </a>\n                              </div>\n                            </div>\n                            <div className=\"bg-muted p-4 rounded-md text-sm whitespace-pre-wrap\">\n                              {submission.message}\n                            </div>\n                            {submission.origin && (\n                              <div className=\"text-xs text-muted-foreground\">\n                                Origin: {submission.origin}\n                              </div>\n                            )}\n                          </div>\n                        </DialogContent>\n                      </Dialog>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                        onClick={() => handleDelete(submission.id)}\n                      >\n                        <Trash className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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"}