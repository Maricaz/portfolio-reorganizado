{"version":3,"file":"ResetPassword-BKUSWZZF.js","names":["err: any"],"sources":["../../src/pages/admin/ResetPassword.tsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { useNavigate, Link } from 'react-router-dom'\nimport { useAuth } from '@/hooks/use-auth'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport * as z from 'zod'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n  CardFooter,\n} from '@/components/ui/card'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { Loader2, CheckCircle, AlertCircle } from 'lucide-react'\nimport { useToast } from '@/hooks/use-toast'\nimport { logSecurityEvent, triggerSecurityAlert } from '@/services/security'\n\nconst formSchema = z\n  .object({\n    password: z\n      .string()\n      .min(6, { message: 'A senha deve ter pelo menos 6 caracteres.' }),\n    confirmPassword: z.string(),\n  })\n  .refine((data) => data.password === data.confirmPassword, {\n    message: 'As senhas não coincidem.',\n    path: ['confirmPassword'],\n  })\n\nexport default function ResetPassword() {\n  const [success, setSuccess] = useState(false)\n  const [serverError, setServerError] = useState<string | null>(null)\n  const { updatePassword, session, loading } = useAuth()\n  const navigate = useNavigate()\n  const { toast } = useToast()\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      password: '',\n      confirmPassword: '',\n    },\n  })\n\n  const { isSubmitting } = form.formState\n\n  const onSubmit = async (values: z.infer<typeof formSchema>) => {\n    setServerError(null)\n\n    try {\n      const { error } = await updatePassword(values.password)\n      if (error) throw error\n\n      setSuccess(true)\n\n      // Audit and Alert\n      logSecurityEvent('PASSWORD_UPDATED', { success: true })\n      triggerSecurityAlert('PASSWORD_RESET', {\n        title: 'Security Alert: Password Changed',\n        message: 'Your account password has been successfully updated.',\n      })\n\n      toast({\n        title: 'Senha atualizada',\n        description: 'Sua senha foi redefinida com sucesso.',\n      })\n\n      setTimeout(() => {\n        navigate('/admin/login')\n      }, 3000)\n    } catch (err: any) {\n      setServerError(err.message || 'Erro ao atualizar a senha.')\n    }\n  }\n\n  // Loading State\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-muted/20\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          <p className=\"text-muted-foreground\">\n            Verificando link de recuperação...\n          </p>\n        </div>\n      </div>\n    )\n  }\n\n  // Invalid or Expired Session\n  if (!session) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-muted/20 p-4 animate-fade-in\">\n        <Card className=\"w-full max-w-md shadow-lg border-destructive/20\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-12 h-12 bg-destructive/10 rounded-full flex items-center justify-center mb-2\">\n              <AlertCircle className=\"w-6 h-6 text-destructive\" />\n            </div>\n            <CardTitle className=\"text-xl text-destructive\">\n              Link Inválido ou Expirado\n            </CardTitle>\n            <CardDescription>\n              O link de recuperação de senha que você usou não é válido ou já\n              expirou.\n            </CardDescription>\n          </CardHeader>\n          <CardFooter className=\"flex flex-col gap-2\">\n            <Button asChild className=\"w-full\">\n              <Link to=\"/admin/forgot-password\">Solicitar novo link</Link>\n            </Button>\n            <Button variant=\"ghost\" asChild className=\"w-full\">\n              <Link to=\"/admin/login\">Voltar ao Login</Link>\n            </Button>\n          </CardFooter>\n        </Card>\n      </div>\n    )\n  }\n\n  // Success State\n  if (success) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-muted/20 p-4 animate-fade-in\">\n        <Card className=\"w-full max-w-md shadow-lg border-green-200\">\n          <CardContent className=\"pt-6 text-center space-y-4\">\n            <div className=\"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n            </div>\n            <h2 className=\"text-2xl font-bold text-green-700\">Sucesso!</h2>\n            <p className=\"text-muted-foreground\">\n              Sua senha foi atualizada. Você será redirecionado para o login em\n              instantes.\n            </p>\n            <Button\n              className=\"w-full mt-4\"\n              onClick={() => navigate('/admin/login')}\n            >\n              Ir para Login agora\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  // Main Form\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-muted/20 p-4 animate-fade-in\">\n      <Card className=\"w-full max-w-md shadow-lg border-primary/10\">\n        <CardHeader className=\"space-y-1\">\n          <CardTitle className=\"text-2xl font-bold text-center\">\n            Redefinir Senha\n          </CardTitle>\n          <CardDescription className=\"text-center\">\n            Digite sua nova senha abaixo\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              {serverError && (\n                <Alert variant=\"destructive\">\n                  <AlertDescription>{serverError}</AlertDescription>\n                </Alert>\n              )}\n              <FormField\n                control={form.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Nova Senha</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"••••••\"\n                        autoComplete=\"new-password\"\n                        disabled={isSubmitting}\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"confirmPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Confirmar Senha</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"••••••\"\n                        autoComplete=\"new-password\"\n                        disabled={isSubmitting}\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting}>\n                {isSubmitting ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Atualizando...\n                  </>\n                ) : (\n                  'Atualizar Senha'\n                )}\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"mappings":"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"}