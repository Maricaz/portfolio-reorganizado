{"version":3,"file":"AdminLogin-7kTO5CjV.js","names":["error: any"],"sources":["../../../../cache/modules/portfolio-reorganizado-7831f/node_modules/.pnpm/lucide-react@0.562.0_react@19.2.3/node_modules/lucide-react/dist/esm/icons/lock.js","../../src/pages/admin/AdminLogin.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.562.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"18\", height: \"11\", x: \"3\", y: \"11\", rx: \"2\", ry: \"2\", key: \"1w4ew1\" }],\n  [\"path\", { d: \"M7 11V7a5 5 0 0 1 10 0v4\", key: \"fwvmzm\" }]\n];\nconst Lock = createLucideIcon(\"lock\", __iconNode);\n\nexport { __iconNode, Lock as default };\n//# sourceMappingURL=lock.js.map\n","import { useState, useEffect } from 'react'\nimport { useAuth } from '@/hooks/use-auth'\nimport { useNavigate, Link } from 'react-router-dom'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from '@/components/ui/card'\nimport { useToast } from '@/hooks/use-toast'\nimport { supabase } from '@/lib/supabase/client'\nimport { ShieldAlert, Loader2, Lock, Mail, AlertCircle } from 'lucide-react'\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\n\nexport default function AdminLogin() {\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [loginError, setLoginError] = useState<string | null>(null)\n\n  // MFA State\n  const [mfaRequired, setMfaRequired] = useState(false)\n  const [mfaCode, setMfaCode] = useState('')\n  const [factorId, setFactorId] = useState<string | null>(null)\n\n  const { signIn, verifyMfa, user, isAdmin, signOut } = useAuth()\n  const navigate = useNavigate()\n  const { toast } = useToast()\n\n  // Redirect if already logged in as Admin\n  useEffect(() => {\n    if (user && isAdmin) {\n      navigate('/admin')\n    }\n  }, [user, isAdmin, navigate])\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setLoginError(null)\n\n    try {\n      // 1. Sign In (includes resilient profile fetch)\n      // The signIn function from useAuth now handles retries for profile\n      // and returns the role\n      const { data, error, role } = await signIn(email, password)\n\n      if (error) {\n        if (\n          error.message.includes('Invalid login credentials') ||\n          error.message.includes('Email not confirmed')\n        ) {\n          throw new Error('Email ou senha incorretos.')\n        }\n        throw new Error(error.message)\n      }\n\n      if (!data.user) {\n        throw new Error('Erro inesperado: dados do usuário não retornados.')\n      }\n\n      // 2. Validate Role (based on what useAuth returned or context)\n      // We check the returned role directly to avoid race conditions with context updates\n      const currentRole = role || 'user'\n      const allowedRoles = ['admin', 'super_admin', 'editor']\n\n      if (!allowedRoles.includes(currentRole)) {\n        await signOut()\n        console.warn(`Access denied for role: ${currentRole}`)\n        throw new Error(\n          'Acesso negado: Esta conta não possui privilégios de administrador.',\n        )\n      }\n\n      // 3. Check for MFA Factors\n      const { data: factorsData, error: factorsError } =\n        await supabase.auth.mfa.listFactors()\n\n      if (factorsError) {\n        console.warn('MFA check failed:', factorsError)\n      }\n\n      const verifiedFactors =\n        factorsData?.all?.filter((f) => f.status === 'verified') || []\n\n      if (verifiedFactors.length > 0) {\n        // MFA Required\n        setFactorId(verifiedFactors[0].id)\n        setMfaRequired(true)\n        setLoading(false)\n      } else {\n        // Success\n        toast({\n          title: 'Bem-vinda de volta!',\n          description: 'Login administrativo realizado com sucesso.',\n        })\n        navigate('/admin')\n        setLoading(false)\n      }\n    } catch (error: any) {\n      setLoading(false)\n      const errorMessage =\n        error.message || 'Ocorreu um erro ao tentar entrar. Tente novamente.'\n\n      console.error('Login process error:', error)\n      setLoginError(errorMessage)\n\n      // Only show toast if it's not a simple validation error (user sees alert in form)\n      if (\n        !errorMessage.includes('Email ou senha') &&\n        !errorMessage.includes('Acesso negado')\n      ) {\n        toast({\n          title: 'Falha no Login',\n          description: errorMessage,\n          variant: 'destructive',\n        })\n      }\n    }\n  }\n\n  const handleMfaVerify = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!factorId) return\n\n    setLoading(true)\n    const { error } = await verifyMfa(factorId, mfaCode)\n    setLoading(false)\n\n    if (error) {\n      toast({\n        title: 'Código MFA Inválido',\n        description: error.message,\n        variant: 'destructive',\n      })\n    } else {\n      navigate('/admin')\n    }\n  }\n\n  if (mfaRequired) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-muted/20 p-4 animate-fade-in\">\n        <Card className=\"w-full max-w-md border-primary/20 shadow-lg\">\n          <CardHeader className=\"space-y-1\">\n            <div className=\"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4\">\n              <ShieldAlert className=\"w-6 h-6 text-primary\" />\n            </div>\n            <CardTitle className=\"text-center\">\n              Autenticação de Dois Fatores\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              Digite o código do seu aplicativo autenticador\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleMfaVerify} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"mfa-code\" className=\"sr-only\">\n                  Código de Autenticação\n                </Label>\n                <Input\n                  id=\"mfa-code\"\n                  type=\"text\"\n                  value={mfaCode}\n                  onChange={(e) => setMfaCode(e.target.value)}\n                  className=\"text-center text-lg tracking-widest\"\n                  placeholder=\"000000\"\n                  maxLength={6}\n                  autoFocus\n                  required\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={loading || mfaCode.length !== 6}\n              >\n                {loading ? 'Verificando...' : 'Verificar'}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                type=\"button\"\n                className=\"w-full text-xs text-muted-foreground\"\n                onClick={() => window.location.reload()}\n              >\n                Voltar ao Login\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-muted/20 p-4 animate-fade-in\">\n      <Card className=\"w-full max-w-md shadow-lg border-primary/10\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"mx-auto mb-2\">\n            <div className=\"p-3 bg-primary/10 rounded-full\">\n              <Lock className=\"w-6 h-6 text-primary\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-center text-2xl font-bold\">\n            Área Administrativa\n          </CardTitle>\n          <CardDescription className=\"text-center\">\n            Entre com suas credenciais para acessar o painel\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleLogin} className=\"space-y-4\">\n            {loginError && (\n              <Alert variant=\"destructive\" className=\"animate-fade-in\">\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertTitle>Erro</AlertTitle>\n                <AlertDescription className=\"text-xs mt-1\">\n                  {loginError}\n                </AlertDescription>\n              </Alert>\n            )}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"admin@exemplo.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  disabled={loading}\n                  className=\"pl-9\"\n                  autoComplete=\"email\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"password\">Senha</Label>\n                <Link\n                  to=\"/admin/forgot-password\"\n                  className=\"text-xs text-primary hover:underline underline-offset-4\"\n                >\n                  Esqueceu a senha?\n                </Link>\n              </div>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"••••••\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  disabled={loading}\n                  className=\"pl-9\"\n                  autoComplete=\"current-password\"\n                />\n              </div>\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={loading}>\n              {loading ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Entrando...\n                </>\n              ) : (\n                'Entrar'\n              )}\n            </Button>\n\n            {loginError && (\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"w-full text-xs text-muted-foreground mt-2\"\n                onClick={() => setLoginError(null)}\n              >\n                Tentar novamente\n              </Button>\n            )}\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"x_google_ignoreList":[0],"mappings":";;;;;;AAaA,IAAM,OAAO,iBAAiB,QAJX,CACjB,CAAC,QAAQ;CAAE,OAAO;CAAM,QAAQ;CAAM,GAAG;CAAK,GAAG;CAAM,IAAI;CAAK,IAAI;CAAK,KAAK;CAAU,CAAC,EACzF,CAAC,QAAQ;CAAE,GAAG;CAA4B,KAAK;CAAU,CAAC,CAC3D,CACgD;;;ACKjD,SAAwB,aAAa;CACnC,MAAM,CAAC,OAAO,aAAA,GAAA,aAAA,UAAqB,GAAG;CACtC,MAAM,CAAC,UAAU,gBAAA,GAAA,aAAA,UAAwB,GAAG;CAC5C,MAAM,CAAC,SAAS,eAAA,GAAA,aAAA,UAAuB,MAAM;CAC7C,MAAM,CAAC,YAAY,kBAAA,GAAA,aAAA,UAAyC,KAAK;CAGjE,MAAM,CAAC,aAAa,mBAAA,GAAA,aAAA,UAA2B,MAAM;CACrD,MAAM,CAAC,SAAS,eAAA,GAAA,aAAA,UAAuB,GAAG;CAC1C,MAAM,CAAC,UAAU,gBAAA,GAAA,aAAA,UAAuC,KAAK;CAE7D,MAAM,EAAE,QAAQ,WAAW,MAAM,SAAS,YAAY,SAAS;CAC/D,MAAM,WAAW,aAAa;CAC9B,MAAM,EAAE,UAAU,UAAU;AAG5B,EAAA,GAAA,aAAA,iBAAgB;AACd,MAAI,QAAQ,QACV,UAAS,SAAS;IAEnB;EAAC;EAAM;EAAS;EAAS,CAAC;CAE7B,MAAM,cAAc,OAAO,MAAuB;AAChD,IAAE,gBAAgB;AAClB,aAAW,KAAK;AAChB,gBAAc,KAAK;AAEnB,MAAI;GAIF,MAAM,EAAE,MAAM,OAAO,SAAS,MAAM,OAAO,OAAO,SAAS;AAE3D,OAAI,OAAO;AACT,QACE,MAAM,QAAQ,SAAS,4BAA4B,IACnD,MAAM,QAAQ,SAAS,sBAAsB,CAE7C,OAAM,IAAI,MAAM,6BAA6B;AAE/C,UAAM,IAAI,MAAM,MAAM,QAAQ;;AAGhC,OAAI,CAAC,KAAK,KACR,OAAM,IAAI,MAAM,oDAAoD;GAKtE,MAAM,cAAc,QAAQ;AAG5B,OAAI,CAFiB;IAAC;IAAS;IAAe;IAAS,CAErC,SAAS,YAAY,EAAE;AACvC,UAAM,SAAS;AACf,YAAQ,KAAK,2BAA2B,cAAc;AACtD,UAAM,IAAI,MACR,qEACD;;GAIH,MAAM,EAAE,MAAM,aAAa,OAAO,iBAChC,MAAM,SAAS,KAAK,IAAI,aAAa;AAEvC,OAAI,aACF,SAAQ,KAAK,qBAAqB,aAAa;GAGjD,MAAM,kBACJ,aAAa,KAAK,QAAQ,MAAM,EAAE,WAAW,WAAW,IAAI,EAAE;AAEhE,OAAI,gBAAgB,SAAS,GAAG;AAE9B,gBAAY,gBAAgB,GAAG,GAAG;AAClC,mBAAe,KAAK;AACpB,eAAW,MAAM;UACZ;AAEL,UAAM;KACJ,OAAO;KACP,aAAa;KACd,CAAC;AACF,aAAS,SAAS;AAClB,eAAW,MAAM;;WAEZA,OAAY;AACnB,cAAW,MAAM;GACjB,MAAM,eACJ,MAAM,WAAW;AAEnB,WAAQ,MAAM,wBAAwB,MAAM;AAC5C,iBAAc,aAAa;AAG3B,OACE,CAAC,aAAa,SAAS,iBAAiB,IACxC,CAAC,aAAa,SAAS,gBAAgB,CAEvC,OAAM;IACJ,OAAO;IACP,aAAa;IACb,SAAS;IACV,CAAC;;;CAKR,MAAM,kBAAkB,OAAO,MAAuB;AACpD,IAAE,gBAAgB;AAClB,MAAI,CAAC,SAAU;AAEf,aAAW,KAAK;EAChB,MAAM,EAAE,UAAU,MAAM,UAAU,UAAU,QAAQ;AACpD,aAAW,MAAM;AAEjB,MAAI,MACF,OAAM;GACJ,OAAO;GACP,aAAa,MAAM;GACnB,SAAS;GACV,CAAC;MAEF,UAAS,SAAS;;AAItB,KAAI,YACF,QACE,iBAAA,GAAA,mBAAA,KAAC,OAAA;EAAI,WAAU;YACb,iBAAA,GAAA,mBAAA,MAAC,MAAA;GAAK,WAAU;cACd,iBAAA,GAAA,mBAAA,MAAC,YAAA;IAAW,WAAU;;KACpB,iBAAA,GAAA,mBAAA,KAAC,OAAA;MAAI,WAAU;gBACb,iBAAA,GAAA,mBAAA,KAAC,aAAA,EAAY,WAAU,wBAAA,CAAyB;OAC5C;KACN,iBAAA,GAAA,mBAAA,KAAC,WAAA;MAAU,WAAU;gBAAc;OAEvB;KACZ,iBAAA,GAAA,mBAAA,KAAC,iBAAA;MAAgB,WAAU;gBAAc;OAEvB;;KACP,EACb,iBAAA,GAAA,mBAAA,KAAC,aAAA,EAAA,UACC,iBAAA,GAAA,mBAAA,MAAC,QAAA;IAAK,UAAU;IAAiB,WAAU;;KACzC,iBAAA,GAAA,mBAAA,MAAC,OAAA;MAAI,WAAU;iBACb,iBAAA,GAAA,mBAAA,KAAC,OAAA;OAAM,SAAQ;OAAW,WAAU;iBAAU;QAEtC,EACR,iBAAA,GAAA,mBAAA,KAAC,OAAA;OACC,IAAG;OACH,MAAK;OACL,OAAO;OACP,WAAW,MAAM,WAAW,EAAE,OAAO,MAAM;OAC3C,WAAU;OACV,aAAY;OACZ,WAAW;OACX,WAAA;OACA,UAAA;QACA,CAAA;OACE;KACN,iBAAA,GAAA,mBAAA,KAAC,QAAA;MACC,MAAK;MACL,WAAU;MACV,UAAU,WAAW,QAAQ,WAAW;gBAEvC,UAAU,mBAAmB;OACvB;KACT,iBAAA,GAAA,mBAAA,KAAC,QAAA;MACC,SAAQ;MACR,MAAK;MACL,WAAU;MACV,eAAe,OAAO,SAAS,QAAQ;gBACxC;OAEQ;;KACJ,EAAA,CACK,CAAA;IACT;GACH;AAIV,QACE,iBAAA,GAAA,mBAAA,KAAC,OAAA;EAAI,WAAU;YACb,iBAAA,GAAA,mBAAA,MAAC,MAAA;GAAK,WAAU;cACd,iBAAA,GAAA,mBAAA,MAAC,YAAA;IAAW,WAAU;;KACpB,iBAAA,GAAA,mBAAA,KAAC,OAAA;MAAI,WAAU;gBACb,iBAAA,GAAA,mBAAA,KAAC,OAAA;OAAI,WAAU;iBACb,iBAAA,GAAA,mBAAA,KAAC,MAAA,EAAK,WAAU,wBAAA,CAAyB;QACrC;OACF;KACN,iBAAA,GAAA,mBAAA,KAAC,WAAA;MAAU,WAAU;gBAAiC;OAE1C;KACZ,iBAAA,GAAA,mBAAA,KAAC,iBAAA;MAAgB,WAAU;gBAAc;OAEvB;;KACP,EACb,iBAAA,GAAA,mBAAA,KAAC,aAAA,EAAA,UACC,iBAAA,GAAA,mBAAA,MAAC,QAAA;IAAK,UAAU;IAAa,WAAU;;KACpC,cACC,iBAAA,GAAA,mBAAA,MAAC,OAAA;MAAM,SAAQ;MAAc,WAAU;;OACrC,iBAAA,GAAA,mBAAA,KAAC,aAAA,EAAY,WAAU,WAAA,CAAY;OACnC,iBAAA,GAAA,mBAAA,KAAC,YAAA,EAAA,UAAW,QAAA,CAAiB;OAC7B,iBAAA,GAAA,mBAAA,KAAC,kBAAA;QAAiB,WAAU;kBACzB;SACgB;;OACb;KAEV,iBAAA,GAAA,mBAAA,MAAC,OAAA;MAAI,WAAU;iBACb,iBAAA,GAAA,mBAAA,KAAC,OAAA;OAAM,SAAQ;iBAAQ;QAAa,EACpC,iBAAA,GAAA,mBAAA,MAAC,OAAA;OAAI,WAAU;kBACb,iBAAA,GAAA,mBAAA,KAAC,MAAA,EAAK,WAAU,uDAAA,CAAwD,EACxE,iBAAA,GAAA,mBAAA,KAAC,OAAA;QACC,IAAG;QACH,MAAK;QACL,aAAY;QACZ,OAAO;QACP,WAAW,MAAM,SAAS,EAAE,OAAO,MAAM;QACzC,UAAA;QACA,UAAU;QACV,WAAU;QACV,cAAa;SACb,CAAA;QACE,CAAA;OACF;KACN,iBAAA,GAAA,mBAAA,MAAC,OAAA;MAAI,WAAU;iBACb,iBAAA,GAAA,mBAAA,MAAC,OAAA;OAAI,WAAU;kBACb,iBAAA,GAAA,mBAAA,KAAC,OAAA;QAAM,SAAQ;kBAAW;SAAa,EACvC,iBAAA,GAAA,mBAAA,KAAC,MAAA;QACC,IAAG;QACH,WAAU;kBACX;SAEM,CAAA;QACH,EACN,iBAAA,GAAA,mBAAA,MAAC,OAAA;OAAI,WAAU;kBACb,iBAAA,GAAA,mBAAA,KAAC,MAAA,EAAK,WAAU,uDAAA,CAAwD,EACxE,iBAAA,GAAA,mBAAA,KAAC,OAAA;QACC,IAAG;QACH,MAAK;QACL,aAAY;QACZ,OAAO;QACP,WAAW,MAAM,YAAY,EAAE,OAAO,MAAM;QAC5C,UAAA;QACA,UAAU;QACV,WAAU;QACV,cAAa;SACb,CAAA;QACE,CAAA;OACF;KACN,iBAAA,GAAA,mBAAA,KAAC,QAAA;MAAO,MAAK;MAAS,WAAU;MAAS,UAAU;gBAChD,UACC,iBAAA,GAAA,mBAAA,MAAA,mBAAA,UAAA,EAAA,UAAA,CACE,iBAAA,GAAA,mBAAA,KAAC,cAAA,EAAQ,WAAU,6BAAA,CAA8B,EAAA,cAAA,EAAA,CAEhD,GAEH;OAEK;KAER,cACC,iBAAA,GAAA,mBAAA,KAAC,QAAA;MACC,MAAK;MACL,SAAQ;MACR,MAAK;MACL,WAAU;MACV,eAAe,cAAc,KAAK;gBACnC;OAEQ;;KAEN,EAAA,CACK,CAAA;IACT;GACH"}